<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AR BOX ONLY</title>
  <style>
    body { margin: 0; background-color: transparent !important; overflow: hidden; }
    canvas { display: block; }
    
    /* TOMBOL HIJAU */
    #btn-place {
      position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%);
      padding: 15px 40px; background-color: #00ff00; color: black;
      font-weight: bold; font-size: 18px; border-radius: 50px; border: 3px solid white;
      z-index: 9999;
    }
    
    /* COUNTER DEBUG (PENTING) */
    #debug-count {
      position: absolute; top: 20px; left: 20px;
      color: yellow; font-family: monospace; font-size: 24px; font-weight: bold;
      text-shadow: 2px 2px 0px black; pointer-events: none; z-index: 9999;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/p5.xr@latest/dist/p5xr.min.js"></script>
</head>
<body>

  <div id="debug-count">JUMLAH OBJEK: 0</div>
  <button id="btn-place">TARUH KOTAK</button>

  <script>
    let placedObjects = [];

    function setup() {
      createCanvas(windowWidth, windowHeight, WEBGL);
      createARCanvas();
      
      // Setup Tombol
      const btn = document.getElementById('btn-place');
      btn.addEventListener('touchstart', (e) => { e.preventDefault(); spawnObject(); });
      btn.addEventListener('click', (e) => { spawnObject(); });
    }

    function spawnObject() {
      if (typeof xr !== 'undefined' && xr.session) {
        // Taruh di -1 meter (depan mata)
        let loc = createVector(0, 0, -1);
        placedObjects.push(loc);
        
        // Update teks tombol & counter
        document.getElementById('btn-place').innerText = "OK!";
        setTimeout(() => document.getElementById('btn-place').innerText = "TARUH KOTAK", 500);
        
        // Update Counter di Layar
        document.getElementById('debug-count').innerText = "JUMLAH OBJEK: " + placedObjects.length;
      }
    }

    function draw() {
      clear();
      ambientLight(200);
      directionalLight(255, 255, 255, 1, 1, -1);

      // 1. RETICLE (LINGKARAN KUNING)
      push();
      translate(0, 0, -1);
      rotateZ(frameCount * 0.05);
      noFill();
      stroke(255, 255, 0);
      strokeWeight(4);
      ellipse(0, 0, 0.1, 0.1);
      pop();

      // 2. RENDER OBJEK (KOTAK PELANGI)
      for (let i = 0; i < placedObjects.length; i++) {
        let obj = placedObjects[i];
        
        push();
        translate(obj.x, obj.y, obj.z);
        
        // ROTASI: Biar kelihatan 3D-nya
        rotateX(frameCount * 0.02);
        rotateY(frameCount * 0.02);
        
        // MATERIAL PELANGI (Paling gampang dilihat)
        normalMaterial(); 
        
        // UKURAN BESAR (20cm)
        box(0.2); 
        pop();
      }
    }
  </script>
</body>
</html>
