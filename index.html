<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AR RAW TOUCH</title>
  <style>
    body { margin: 0; background-color: transparent !important; overflow: hidden; }
    canvas { display: block; }
    
    /* HUD STATUS BESAR */
    #hud {
      position: absolute; top: 20px; left: 0; width: 100%;
      text-align: center; color: lime; font-family: monospace; 
      font-size: 20px; font-weight: bold;
      text-shadow: 2px 2px 0px black; pointer-events: none; z-index: 999;
    }
    
    /* CROSSHAIR TENGAH */
    #crosshair {
      position: absolute; top: 50%; left: 50%;
      width: 20px; height: 20px;
      border: 2px solid yellow; border-radius: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none; z-index: 999;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/p5.xr@latest/dist/p5xr.min.js"></script>
</head>
<body>

  <div id="hud">TAP LAYAR DIMANA AJA!</div>
  <div id="crosshair"></div>

  <script>
    let placedObjects = [];
    let cooldownTimer = 0; // Supaya sekali tap gak keluar 100 kotak

    function setup() {
      createCanvas(windowWidth, windowHeight, WEBGL);
      createARCanvas();
    }

    function draw() {
      clear();
      ambientLight(255); // Cahaya Full Terang

      // --- LOGIKA DETEKSI SENTUHAN (POLLING) ---
      // touches adalah array bawaan p5 yang isinya daftar jari di layar.
      // Kalau length > 0 berarti ada jari nempel.
      
      if (touches.length > 0) {
        // Cek Cooldown (biar gak spamming)
        if (cooldownTimer === 0) {
          spawnObject();
          cooldownTimer = 30; // Delay 30 frame (setengah detik) baru boleh tap lagi
        }
      }

      // Kurangi cooldown setiap frame
      if (cooldownTimer > 0) {
        cooldownTimer--;
      }

      // --- RENDER OBJEK ---
      for (let obj of placedObjects) {
        push();
        translate(obj.x, obj.y, obj.z);
        
        // Animasi Muter
        rotateX(frameCount * 0.02);
        rotateY(frameCount * 0.02);
        
        // MATERIAL PELANGI & KOTAK BESAR
        normalMaterial(); 
        box(0.15); // 15 cm
        pop();
      }
    }

    function spawnObject() {
      // Pastikan mode AR aktif
      if (typeof xr !== 'undefined' && xr.session) {
        // Taruh di posisi bidikan (0.5 meter depan kamera)
        // Kita majuin dikit (-0.5) biar pas di depan muka
        let loc = createVector(0, 0, -0.5);
        applyMatrix();
        placedObjects.push(loc);
        
        // Update HUD Visual
        document.getElementById('hud').innerText = "SUKSES! TOTAL: " + placedObjects.length;
        document.getElementById('hud').style.color = "yellow";
      }
    }
  </script>
</body>
</html>
