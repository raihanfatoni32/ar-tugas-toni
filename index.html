<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AR FINAL FIX DOM</title>
  <style>
    /* PENTING: ID ini akan kita bawa masuk ke AR */
    body {
      margin: 0;
      background-color: transparent !important;
      overflow: hidden;
      font-family: sans-serif;
    }
    canvas { display: block; }

    /* UI YANG AKAN TETAP MUNCUL DI DALAM AR */
    #ar-overlay {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; /* Biar tembus pandang sentuhannya */
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      box-sizing: border-box;
      z-index: 9999;
    }

    #status-text {
      color: #00ff00; /* Hijau Neon */
      font-size: 18px;
      font-weight: bold;
      text-align: center;
      background: rgba(0,0,0,0.5);
      padding: 10px;
      border-radius: 10px;
      margin-top: 50px; /* Jarak dari atas */
    }

    /* LINGKARAN TENGAH (CROSSHAIR) - VERSI HTML */
    #crosshair {
      width: 20px; 
      height: 20px;
      border: 3px solid yellow;
      border-radius: 50%;
      background: rgba(255, 255, 0, 0.3);
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
    }
  </style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/p5.xr@latest/dist/p5xr.min.js"></script>
</head>
<body>

  <div id="ar-overlay">
    <div id="status-text">MENUNGGU TOMBOL AR...</div>
    <div id="crosshair"></div> </div>

  <script>
    let chairModel = null;
    let isARStarted = false;

    function setup() {
      createCanvas(windowWidth, windowHeight, WEBGL);

      // --- KUNCI RAHASIA: DOM OVERLAY ---
      // Ini perintah biar HTML overlay TETAP MUNCUL di dalam AR
      createARCanvas({
        domOverlay: { root: document.body } 
      });

      // LOAD MODEL
      loadModel('chair.obj', true, 
        (model) => {
          chairModel = model;
          document.getElementById('status-text').innerText = "MODEL SIAP! KLIK ENTER AR";
        },
        (err) => {
          document.getElementById('status-text').innerText = "MODEL GAGAL (AKAN MUNCUL KOTAK)";
          document.getElementById('status-text').style.color = "red";
        }
      );
    }

    function draw() {
      clear();
      ambientLight(255);
      directionalLight(255, 255, 255, 1, 1, -1);

      // DETEKSI APAKAH AR SUDAH JALAN?
      // Kalau xr.session aktif, berarti kita sudah masuk mode kamera
      if (typeof xr !== 'undefined' && xr.session) {
        if (!isARStarted) {
          isARStarted = true;
          document.getElementById('status-text').innerText = "AR AKTIF! LIHAT DEPAN!";
        }

        // --- RENDER OBJEK OTOMATIS (HEAD-LOCKED) ---
        // Objek ini akan selalu melayang 1 meter di depan HP kamu
        // Gak perlu diklik, dia bakal ngikutin gerakan HP.
        
        push();
        translate(0, 0, -1); // 1 Meter depan kamera
        
        // Animasi Muter Biar Kelihatan
        rotateY(frameCount * 0.01);
        
        // 1. KOTAK MERAH (Test) - Pasti Muncul
        push();
        noStroke();
        fill(255, 0, 0, 150); // Merah Transparan
        box(0.2); // Kotak 20cm
        pop();

        // 2. KURSI (Tugas) - Muncul kalau file sehat
        if (chairModel) {
          push();
          translate(0, -0.2, 0); // Turunin dikit
          scale(0.05); // Skala kursi
          rotateX(PI);
          normalMaterial();
          model(chairModel);
          pop();
        }
        pop();
        
      }
    }
  </script>
</body>
</html>
