<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AR SHOTGUN TEST</title>
  <style>
    body { margin: 0; background-color: transparent !important; overflow: hidden; }
    canvas { display: block; }
    #hud {
      position: absolute; top: 20px; width: 100%; text-align: center;
      color: lime; font-family: monospace; font-weight: bold; font-size: 16px;
      text-shadow: 1px 1px 2px black; pointer-events: none; z-index: 999;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/p5.xr@latest/dist/p5xr.min.js"></script>
</head>
<body>
  <div id="hud">MENUNGGU SYSTEM...</div>
  <script>
    let chairModel;
    let placedGroups = []; // Kita simpan grup posisi
    let loadStatus = "LOADING"; // LOADING, SUCCESS, FAIL

    function setup() {
      createCanvas(windowWidth, windowHeight, WEBGL);
      createARCanvas();

      // Update Status HUD
      document.getElementById('hud').innerText = "MENCOBA DOWNLOAD MODEL...";

      // LOAD MODEL
      loadModel('chair.obj', true, 
        (model) => {
          chairModel = model;
          loadStatus = "SUCCESS";
          document.getElementById('hud').innerText = "MODEL AMAN! TAP LAYAR SEKARANG";
          document.getElementById('hud').style.color = "#00FF00"; // Hijau
        },
        (err) => {
          loadStatus = "FAIL";
          document.getElementById('hud').innerText = "GAGAL LOAD MODEL! (NAMA FILE SALAH?)";
          document.getElementById('hud').style.color = "#FF0000"; // Merah
        }
      );
    }

    function draw() {
      clear();
      ambientLight(150);
      directionalLight(255, 255, 255, 1, 1, -1);

      // LOOPING GRUP OBJEK
      for (let grp of placedGroups) {
        push();
        translate(grp.x, grp.y, grp.z);
        
        // KITA RENDER 3 VARIASI SEKALIGUS

        // 1. TENGAH: PATOKAN (KOTAK KUNING)
        // Kalau ini gak muncul, berarti AR error.
        push();
        fill(255, 255, 0); // Kuning
        box(0.05); // 5cm
        pop();

        // LOGIC RENDER MODEL
        if (loadStatus === "SUCCESS") {
          normalMaterial(); // Warna Pelangi

          // VARIASI A: KECIL (Kiri)
          push();
          translate(-0.3, 0, 0); // Geser Kiri 30cm
          scale(0.01); // Skala 1%
          rotateX(PI);
          model(chairModel);
          pop();

          // VARIASI B: SEDANG (Kanan)
          push();
          translate(0.3, 0, 0); // Geser Kanan 30cm
          scale(0.05); // Skala 5%
          rotateX(PI);
          model(chairModel);
          pop();

          // VARIASI C: BESAR (Atas)
          push();
          translate(0, 0.5, 0); // Geser Atas 50cm
          scale(0.1); // Skala 10%
          rotateX(PI);
          model(chairModel);
          pop();

        } else if (loadStatus === "FAIL") {
          // Kalau gagal load, munculin BOLA MERAH
          push();
          translate(0, 0.2, 0);
          fill(255, 0, 0);
          sphere(0.1);
          pop();
        }
        
        pop(); // End Group
      }
    }

    function mousePressed() {
      if (typeof xr !== 'undefined' && xr.session) {
        // Taruh 1 meter di depan
        let loc = createVector(0, 0, -1);
        applyMatrix();
        placedGroups.push(loc);
      }
    }
  </script>
</body>
</html>
